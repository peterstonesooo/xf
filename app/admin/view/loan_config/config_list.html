<div class="search">
    <form class="form-inline">
        <input type="text" value="{$req['config_key']??''}" name="config_key" placeholder="搜索配置键" class="form-control">
        <input type="text" value="{$req['config_desc']??''}" name="config_desc" placeholder="搜索配置描述" class="form-control">
        <select name="config_type" class="form-control">
            <option value="">配置类型</option>
            {volist name="configTypeMap" id="v" key="k"}
                <option value="{$k}" {if condition="isset($req['config_type']) && $req['config_type'] == $k"}selected{/if}>{$v}</option>
            {/volist}
        </select>
        <select name="is_show" class="form-control">
            <option value="">显示状态</option>
            {volist name="isShowMap" id="v" key="k"}
                <option value="{$k}" {if condition="isset($req['is_show']) && $req['is_show'] == $k"}selected{/if}>{$v}</option>
            {/volist}
        </select>
        <input class="btn btn-flat btn-primary m_10" type="submit" value="搜索">
        <a href="{:url('admin/LoanConfig/showConfig')}" class="btn btn-flat btn-success m_10">添加配置</a>
        <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;共 {$data->total()} 条记录</span>
    </form>
</div>

<div class="row">
    <div class="col-xs-12">
        <div class="box">
            <div class="box-header">
                <div class="box-body table-responsive no-padding">
                    <table class="table table-bordered table-hover table-striped">
                        <tbody>
                        <tr>
                            <th>ID</th>
                            <th>配置键</th>
                            <th>配置值</th>
                            <th>配置描述</th>
                            <th>配置类型</th>
                            <th>排序</th>
                            <th>显示状态</th>
                            <th>更新时间</th>
                            <th>操作</th>
                        </tr>
                        {volist name="data" id="v"}
                            <tr>
                                <td>{$v['id']}</td>
                                <td>{$v['config_key']}</td>
                                <td>
                                    {if condition="$v['config_type'] == 'textarea'"}
                                        <div style="max-width: 200px; max-height: 100px; overflow: auto;">
                                            {$v['config_value']}
                                        </div>
                                    {else/}
                                        {$v['config_value']}
                                    {/if}
                                </td>
                                <td>{$v['config_desc']}</td>
                                <td>{$v['config_type_text']}</td>
                                <td>{$v['sort']}</td>
                                <td>
                                    <span class="label label-{if condition="$v['is_show'] == 1"}success{else/}danger{/if}">{$v['is_show_text']}</span>
                                </td>
                                <td>{$v['updated_at']}</td>
                                <td>
                                    <a href="{:url('admin/LoanConfig/showConfig', ['id' => $v['id']])}" class="btn btn-flat btn-primary btn-xs">编辑</a>
                                    <button class="btn btn-flat btn-{if condition="$v['is_show'] == 1"}warning{else/}success{/if} btn-xs" onclick="changeShowStatus({$v['id']}, {$v['is_show'] == 1 ? 0 : 1})">
                                        {if condition="$v['is_show'] == 1"}隐藏{else/}显示{/if}
                                    </button>
                                    <button class="btn btn-flat btn-danger btn-xs" onclick="deleteConfig({$v['id']})">删除</button>
                                </td>
                            </tr>
                        {/volist}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function changeShowStatus(id, isShow) {
    var action = isShow == 1 ? '显示' : '隐藏';
    if (confirm('确定要' + action + '该配置吗？')) {
        $.post('{:url("admin/LoanConfig/changeShowStatus")}', {
            id: id,
            is_show: isShow
        }, function(res) {
            if (res.code == 200) {
                alert('操作成功');
                location.reload();
            } else {
                alert(res.msg);
            }
        });
    }
}

function deleteConfig(id) {
    if (confirm('确定要删除该配置吗？')) {
        $.post('{:url("admin/LoanConfig/deleteConfig")}', {
            id: id
        }, function(res) {
            if (res.code == 200) {
                alert('删除成功');
                location.reload();
            } else {
                alert(res.msg);
            }
        });
    }
}
</script>





















