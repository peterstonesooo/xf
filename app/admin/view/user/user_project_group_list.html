<div class="search">
    <form class="form-inline">
        <div class="form-group">
            <label>用户ID：</label>
            <input type="text" class="form-control" name="user_id" value="{$req.user_id|default=''}" placeholder="用户ID">
        </div>
        <div class="form-group">
            <label>手机号：</label>
            <input type="text" class="form-control" name="phone" value="{$req.phone|default=''}" placeholder="手机号">
        </div>
        <div class="form-group">
            <label>产品组：</label>
            <select class="form-control" name="group_id">
                <option value="">全部产品组</option>
                {volist name="groups" id="group"}
                <option value="{$group.id}" {if condition="$req.group_id eq $group.id"}selected{/if}>{$group.name}</option>
                {/volist}
            </select>
        </div>

        <div class="form-group">
            <label>开始日期：</label>
            <input type="date" class="form-control" name="start_date" value="{$req.start_date|default=''}">
        </div>
        <div class="form-group">
            <label>结束日期：</label>
            <input type="date" class="form-control" name="end_date" value="{$req.end_date|default=''}">
        </div>
        <button type="submit" class="btn btn-primary">搜索</button>
        <a class="btn btn-default" href="{:url('admin/User/userProjectGroupList')}">重置</a>
    </form>
</div>

<div class="table-responsive">
    <table class="table table-striped table-bordered table-hover">
        <thead>
            <tr>
                <th>ID</th>
                <th>用户信息</th>
                <th>产品组</th>
                <th>完成进度</th>
                <th>完成时间</th>
                <th>创建时间</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody>
            {volist name="data" id="item"}
            <tr>
                <td>{$item.id}</td>
                <td>
                    ID: {$item.user_id}<br>
                    姓名: {$item.realname|default='未实名'}<br>
                    手机: {$item.phone}
                </td>
                <td>{$item.group_name}</td>
                <td>{$item.completed_count}/{$item.total_count}</td>
                <td>{$item.completed_at|default='-'}</td>
                <td>{$item.created_at}</td>
                <td>
                    <button type="button" class="btn btn-xs btn-info" onclick="updateGroup({$item.user_id})">更新状态</button>
                </td>
            </tr>
            {/volist}
        </tbody>
    </table>
</div>

<div class="pagination-wrapper">
    {$data->render()}
</div>

<script>
    $(function () {
        var url = "{:url('admin/User/userProjectGroupList')}";
        $('a[href="' + url + '"]').parents('.menu-li').addClass('active');
        var headerText = $('a[href="' + url + '"]').children('span').text();

        var headerTitle = headerText + '-' + '用户产品组完成记录';
        $('#content-header-title').text(headerTitle);
    });

    function updateGroup(userId) {
        layer.confirm('确认要更新该用户的产品组完成状态吗？', {
            btn: ['确认','取消']
        }, function(){
            $.post('{:url("admin/User/updateUserProjectGroup")}', {user_id: userId}, function(res) {
                if (res.code == '200') {
                    layer.msg('更新成功', {icon: 1, time: 2000}, function() {
                        location.reload();
                    });
                } else {
                    layer.msg(res.msg, {icon: 5, time: 3000});
                }
            });
        });
    }
</script>
