<div class="row">
    <div class="col-xs-12">
        <div class="box">
            <div class="box-header">
                <h3 class="box-title">修改投票票数</h3>
            </div>
            <div class="box-body">
                <form class="form-horizontal" id="voteForm">
                    <input type="hidden" name="id" value="{$data['id']??''}">
                    
                    <div class="form-group">
                        <label class="col-sm-2 control-label">用户信息</label>
                        <div class="col-sm-8">
                            <div class="form-control-static">
                                <strong>ID:</strong> {$data['uid']??''} | 
                                <strong>手机:</strong> {$data['phone']??''} | 
                                <strong>姓名:</strong> {$data['realname']??''}
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-sm-2 control-label">投票标题</label>
                        <div class="col-sm-8">
                            <div class="form-control-static">{$data['title']??''}</div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-sm-2 control-label">总票数</label>
                        <div class="col-sm-4">
                            <input type="number" name="total_votes" value="{$data['total_votes']??0}" class="form-control" placeholder="总票数" min="0" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="col-sm-offset-2 col-sm-10">
                            <button type="submit" class="btn btn-primary">保存</button>
                            <a href="{:url('admin/Vote/voteList')}" class="btn btn-default">返回</a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    // 表单提交
    $('#voteForm').on('submit', function(e) {
        e.preventDefault();
        
        var formData = {
            id: $('input[name="id"]').val(),
            total_votes: $('input[name="total_votes"]').val()
        };
        
        console.log('提交数据:', formData);
        
        $.post('{:url("admin/Vote/editVote")}', formData, function(res) {
            console.log('服务器响应:', res);
            if (res.code == 200) {
                layer.msg('保存成功', {icon: 1});
                setTimeout(function() {
                    location.href = '{:url("admin/Vote/voteList")}';
                }, 1000);
            } else {
                layer.msg(res.msg || '保存失败', {icon: 5});
            }
        }).fail(function(xhr, status, error) {
            console.log('请求失败:', xhr, status, error);
            layer.msg('网络错误，请重试', {icon: 5});
        });
    });
</script>
